version: v1.1.0
steps:
  - id: build-base-image-test
    build: >
      -f ./Dockerfile
      -t $Registry/node-import:test
      .
  - id: validate-base-image
    cmd: $Registry/node-import:test
    # only continues if node-import:test returns a non-zero code
  - id: az-login
    # login with the identity of the task
    # run concurrently while the image is building: when:
    cmd: >
      az login --identity -o jsonc --debug #> /dev/null
    when: [-]
  - id: import-node-to-base-artifacts
    when: [`az-login`, `build-base-image-test`]
    cmd: >
      az acr import 
      --name $RegistryName 
      --source $Registry/hub/node:9-alpine 
      -t base-artifacts/node:9-alpine
      -t base-artifacts/node:9-alpine-$ID
      --force
      --debug
  
